"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1684],{5680:(e,a,n)=>{n.d(a,{xA:()=>c,yg:()=>p});var t=n(6540);function s(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){s(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,t,s=function(e,a){if(null==e)return{};var n,t,s={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],a.indexOf(n)>=0||(s[n]=e[n]);return s}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)n=r[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=t.createContext({}),g=function(e){var a=t.useContext(l),n=a;return e&&(n="function"==typeof e?e(a):i(i({},a),e)),n},c=function(e){var a=g(e.components);return t.createElement(l.Provider,{value:a},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,s=e.mdxType,r=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=g(n),m=s,p=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return n?t.createElement(p,i(i({ref:a},c),{},{components:n})):t.createElement(p,i({ref:a},c))}));function p(e,a){var n=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var r=n.length,i=new Array(r);i[0]=m;var o={};for(var l in a)hasOwnProperty.call(a,l)&&(o[l]=a[l]);o.originalType=e,o[d]="string"==typeof e?e:s,i[1]=o;for(var g=2;g<r;g++)i[g]=n[g];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6056:(e,a,n)=>{n.r(a),n.d(a,{contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var t=n(8168),s=(n(6540),n(5680));const r={id:"guides.message",title:"Using Message",sidebar_label:"Using Message",slug:"/guides/message"},i=void 0,o={unversionedId:"guides/guides.message",id:"guides/guides.message",isDocsHomePage:!1,title:"Using Message",description:"Creating message",source:"@site/docs/guides/message.md",sourceDirName:"guides",slug:"/guides/message",permalink:"/laravel-chat-system/docs/next/guides/message",editUrl:"https://github.com/binkode/laravel-chat-system-docs/edit/master/docs/guides/message.md",version:"current",frontMatter:{id:"guides.message",title:"Using Message",sidebar_label:"Using Message",slug:"/guides/message"},sidebar:"docs",previous:{title:"Using Conversation",permalink:"/laravel-chat-system/docs/next/guides/conversation"},next:{title:"Using ChatEvent",permalink:"/laravel-chat-system/docs/next/guides/chatEvent"}},l=[{value:"Creating message",id:"creating-message",children:[]},{value:"Broadcasting Message Created",id:"broadcasting-message-created",children:[]},{value:"Creating an activity message type",id:"creating-an-activity-message-type",children:[]},{value:"Creating a message with token",id:"creating-a-message-with-token",children:[]},{value:"Deleting message",id:"deleting-message",children:[]}],g={toc:l},c="wrapper";function d(e){let{components:a,...n}=e;return(0,s.yg)(c,(0,t.A)({},g,n,{components:a,mdxType:"MDXLayout"}),(0,s.yg)("h2",{id:"creating-message"},"Creating message"),(0,s.yg)("p",null,"You may create a message within a conversation using its ",(0,s.yg)("inlineCode",{parentName:"p"},"messages")," relationship method."),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-php"},"$conversation = $user->conversations($conversation_id)->first();\n\n$conversation->messages()->create([\n  'reply_id'        => $reply_id, // eg. message_id\n  'reply_type'      => $reply_type, // eg. message::class\n  'user_id'         => $user->id,\n  'message'         => 'hello laravel',\n  'type'            => 'user', // default user\n]);\n")),(0,s.yg)("h2",{id:"broadcasting-message-created"},"Broadcasting Message Created"),(0,s.yg)("p",null,"You may broadcast a ",(0,s.yg)("a",{parentName:"p",href:"../apis/events/message/created"},"message created event")," after creating a message for websocket clients to receive."),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-php"},"use Binkode\\ChatSystem\\Events\\Message\\Created;\n\nbroadcast(new Created($message));\n")),(0,s.yg)("details",null,(0,s.yg)("summary",null,"output"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-json"},'[2021-07-23 22:36:25] local.INFO: Broadcasting [message] on channels [private-message-created.304, private-message-new.user.13] with payload:\n{\n    "message": {\n        "id": 922,\n        "conversation_id": 304,\n        "user_id": 13,\n        "reply_type": null,\n        "reply_id": null,\n        "message": "i am good",\n        "type": "activity",\n        "metas": null,\n        "created_at": "2021-07-23T22:36:20.000000Z",\n        "updated_at": "2021-07-23T22:36:20.000000Z",\n        "isSender": true,\n        "reply": null\n    },\n    "socket": null\n}  \n'))),(0,s.yg)("h2",{id:"creating-an-activity-message-type"},"Creating an activity message type"),(0,s.yg)("p",null,"A message type is default to ",(0,s.yg)("inlineCode",{parentName:"p"},"user")," which means its a user message.\nYou may want to create another type of messages, for example, a ",(0,s.yg)("inlineCode",{parentName:"p"},"system")," or an ",(0,s.yg)("inlineCode",{parentName:"p"},"activity")," message.\nAn activity message can be used to hold a single event of a conversation. A user leaving a conversation is an event that occurs in a conversation which the event can be remembered by creating an activity message with the event."),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-php"},"$conversation = $user->conversations($conversation_id)->first();\n\n$conversation->createActivityMessage([\n  'user_id'         => $user->id,\n  'message'         => 'Someone left the conversation',\n]);\n")),(0,s.yg)("details",null,(0,s.yg)("summary",null,"output"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "user_id": 13,\n    "message": "Someone left the conversation",\n    "type": "activity",\n    "conversation_id": 304,\n    "updated_at": "2021-07-23T22:36:20.000000Z",\n    "created_at": "2021-07-23T22:36:20.000000Z",\n    "id": 922,\n}\n'))),(0,s.yg)("h2",{id:"creating-a-message-with-token"},"Creating a message with token"),(0,s.yg)("p",null,"You may use message unique token feature to prevent creating duplicate messages.\nFor example, In your frontend app, you might be using job queue to create messages. let assume job queue sent request to the backend to create a message, after the message was created, client network lost and client couldn't know if the message was created but the message was surely created, now exception has occured and job queue has tried to send the same message later after network was regained, now the same message has been created twice.\nIf you had provided a unique token, the backend would have check and responded with an existing message having the token otherwise creates a new message. "),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-php"},"$conversation = $user->conversations($conversation_id)->first();\n\n$conversation->createMessageWithToken($token, [\n  'user_id'         => $user->id,\n  'message'         => 'hello laravel',\n]);\n")),(0,s.yg)("details",null,(0,s.yg)("summary",null,"output"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "user_id": 13,\n    "message": "i am good",\n    "type": "user",\n    "metas": {\n        "token": "1627076937515"\n    },\n    "conversation_id": 300,\n    "updated_at": "2021-07-23T21:48:58.000000Z",\n    "created_at": "2021-07-23T21:48:58.000000Z",\n    "id": 907,\n    "isSender": true,\n}\n'))),(0,s.yg)("h2",{id:"deleting-message"},"Deleting message"),(0,s.yg)("p",null,"You may delete message(s) with ",(0,s.yg)("a",{parentName:"p",href:"../apis/models/message#makedelete"},"makeDelete")," method which requires 1 argument = user deleting the conversation.\nYou can specify delete for all option by passing named argument ",(0,s.yg)("inlineCode",{parentName:"p"},"all")," which will specify that the message has been deleted for all participants.\nThe method will also try to emit ",(0,s.yg)("a",{parentName:"p",href:"../apis/events/message/events"},"Message Events")),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-php"},"$message->makeDelete($user, $everyone);\n")),(0,s.yg)("details",null,(0,s.yg)("summary",null,"output"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-json"},'[2021-07-23 22:54:58] local.INFO: Broadcasting [message] on channels [private-message-event.user.13, private-message-event.user.10] with payload:\n{\n    "event": {\n        "id": 2041,\n        "maker_type": "App\\\\Models\\\\User",\n        "maker_id": 13,\n        "made_type": "App\\\\Models\\\\Message",\n        "made_id": 925,\n        "type": "delete",\n        "all": true,\n        "created_at": "2021-07-23T22:54:57.000000Z",\n        "updated_at": "2021-07-23T22:54:57.000000Z",\n        "made": {\n            "id": 925,\n            "conversation_id": 305,\n            "user_id": 13,\n            "message": "i am good",\n            "type": "user",\n            "metas": {\n                "token": "1627080883413"\n            },\n            "created_at": "2021-07-23T22:54:44.000000Z",\n            "updated_at": "2021-07-23T22:54:44.000000Z",\n        }\n    },\n    "conversation_id": 305,\n    "socket": null\n}\n'))))}d.isMDXComponent=!0}}]);